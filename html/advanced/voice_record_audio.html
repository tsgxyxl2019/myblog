<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.0/jquery.min.js"></script>
    <link rel="stylesheet" href="./html_css/html_css.css">
    <title>Document</title>
    <script type="text/javascript">
        // function playMusic () {
        //     if (!this.value) {
        //         return;
        //     }
        //     // 直接使用File对象生成blob url
        //     let blobUrl = URL.createObjectURL(this.files[0]);
        //     document.querySelector('.audio-node').src = blobUrl;

        //     let fileReader = new FileReader();
        //     let file = this.files[0]
        //     fileReader.onload = function () {
        //         let arrayBuffer = this.result;
        //         play(arrayBuffer);
        //     }
        // }        
        
        // function play (arrayBuffer) {
        //     // Safari需要使用webkit前缀
        //     let AudioContext = window.AudioContext || window.webkitAudioContext,
        //         audioContext = new AudioContext();
        //     // 创建一个AudioBufferSourceNode对象，使用AudioContext的工厂函数创建
        //     let audioNode = audioContext.createBufferSource();
        //     // 解码音频，可以使用Promise，但是较老的Safari需要使用回调
        //     audioContext.decodeAudioData(arrayBuffer, function (audioBuffer) {
        //         console.log(audioBuffer);
        //         audioNode.buffer = audioBuffer;
        //         audioNode.connect(audioContext.destination); 
        //         // 从0s开始播放
        //         audioNode.start(0);
        //     });
        // }



        function playMusic () {
            if (!this.value) {
                return;
            }
            let fileReader = new FileReader();
            let file = this.files[0];

            fileReader.onload = function () {
                let arrayBuffer = this.result;
                // 转成一个blob
                let blob = new Blob([new Int8Array(this.result)]);
                // 生成一个本地的blob url
                let blobUrl = URL.createObjectURL(blob);
                console.log("bloburl:",blobUrl);
                // 给audio标签的src属性
                document.querySelector('.audio-node').src = blobUrl;
                play(arrayBuffer);
            }

            function play (arrayBuffer) {
                // Safari需要使用webkit前缀
                let AudioContext = window.AudioContext || window.webkitAudioContext,
                    audioContext = new AudioContext();
                // 创建一个AudioBufferSourceNode对象，使用AudioContext的工厂函数创建
                let audioNode = audioContext.createBufferSource();
                // 解码音频，可以使用Promise，但是较老的Safari需要使用回调
                audioContext.decodeAudioData(arrayBuffer, function (audioBuffer) {
                    console.log(audioBuffer);
                    audioNode.buffer = audioBuffer;
                    audioNode.connect(audioContext.destination); 
                    // 从0s开始播放
                    audioNode.start(0);
                });
            }
            fileReader.readAsArrayBuffer(this.files[0]);
        }
    </script>
</head>
<body>
    <div class="content">
        <h2>需求:</h2>
        <h3>点击图片一部分内容以转链接，空白非设置部分无效</h3>
        <div class="test_area">
            <h3>Test_area：</h3>
            <div>
                <input type="file" onchange="playMusic.call(this)" class="select-file">
                <audio class="audio-node" autoplay></audio>
            </div>
            <button onclick="record()">开始录音</button>
            <script>
            function record () {
                window.navigator.mediaDevices.getUserMedia({
                    audio: true
                }).then(mediaStream => {
                    console.log(mediaStream);
                    beginRecord(mediaStream);
                }).catch(err => {
                    // 如果用户电脑没有麦克风设备或者用户拒绝了，或者连接出问题了等
                    // 这里都会抛异常，并且通过err.name可以知道是哪种类型的错误 
                    console.error(err);
                })  ;
            }
            </script>
        </div>
        <h3>知识点：</h3>
        <p></p>
        <p></p>
        <p></p>
        <p></p>
        <h3>html源代码：</h3>
<pre>
<code>

</code>
</pre>
        <h3>css源代码：</h3>
<pre>
<code>

</code>
</pre>
        
    </div>
    
</body>
</html>